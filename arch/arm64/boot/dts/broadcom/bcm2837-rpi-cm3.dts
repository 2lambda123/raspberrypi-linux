/dts-v1/;
#include "bcm2837.dtsi"
#include "bcm2835-rpi.dtsi"
#include "bcm283x-rpi-smsc9514.dtsi"

/ {
  compatible = "brcm,bcm2837";
  model = "Raspberry Pi Compute Module 3";

  memory {
    reg = <0 0x40000000>;
  };

  leds {
    act_led: act {
      gpios = <&gpio 47 0>;
    };
  };
};

&uart0 {
  status = "okay";
};

&uart1 {
  status = "okay";
};

&mmc {
  status = "okay";
};

&firmwarekms {
  status = "okay";
};

&hdmi {
  status = "okay";
};

&fb {
  status = "okay";
};

&gpio {
  spi0_pins: spi0_pins {
    brcm,pins = <9 10 11>;
    brcm,function = <4>; /* alt0 */
  };

  spi0_cs_pins: spi0_cs_pins {
    brcm,pins = <8 7>;
    brcm,function = <1>; /* output */
  };

  spi1_pins: spi1_pins {
    brcm,pins = <19 20 21>;
    brcm,function = <3>; /* alt4 */
  };

  spi1_cs_pins: spi1_cs_pins {
    brcm,pins = <18>;
    brcm,function = <1>; /* output */
  };

  i2c0_pins: i2c0 {
    brcm,pins = <0 1>;
    brcm,function = <4>;
  };

  i2c1_pins: i2c1 {
    brcm,pins = <2 3>;
    brcm,function = <4>;
  };

  i2s_pins: i2s {
    brcm,pins = <18 19 20 21>;
    brcm,function = <4>; /* alt0 */
  };
};

&i2c0 {
  pinctrl-names = "default";
  pinctrl-0 = <&i2c0_pins>;
  clock-frequency = <100000>;
};

&i2c1 {
  pinctrl-names = "default";
  pinctrl-0 = <&i2c1_pins>;
  clock-frequency = <100000>;
};

&i2c2 {
  clock-frequency = <100000>;
};

&i2s {
  pinctrl-names = "default";
  pinctrl-0 = <&i2s_pins>;
};

&spi0 {
  pinctrl-names = "default";
  pinctrl-0 = <&spi0_pins &spi0_cs_pins>;
  cs-gpios = <&gpio 8 1>, <&gpio 7 1>;

  spidev0: spidev@0{
    compatible = "spidev";
    reg = <0>;  /* CE0 */
    #address-cells = <1>;
    #size-cells = <0>;
    spi-max-frequency = <125000000>;
  };

  spidev1: spidev@1{
    compatible = "spidev";
    reg = <1>;  /* CE1 */
    #address-cells = <1>;
    #size-cells = <0>;
    spi-max-frequency = <125000000>;
  };

};

&aux {
  status = "okay";
};

&spi1 {
    /* needed to avoid dtc warning */
    #address-cells = <1>;
    #size-cells = <0>;
    pinctrl-names = "default";
    pinctrl-0 = <&spi1_pins &spi1_cs_pins>;
    cs-gpios = <&gpio 18 1>;
    status = "okay";

    spidev1_0: spidev@0 {
      compatible = "spidev";
      reg = <0>;      /* CE0 */
      #address-cells = <1>;
      #size-cells = <0>;
      spi-max-frequency = <500000>;
      status = "okay";
    };
};

&vc4 {
  status = "disabled";
};

/ {
  chosen {
    bootargs = "8250.nr_uarts=1";
  };
};

/ {
  __overrides__ {
    uart0 = <&uart0>,"status";
    uart1 = <&uart1>,"status";
    i2s = <&i2s>,"status";
    spi = <&spi0>,"status";
    spi1 = <&spi1>,"status";
    spi2 = <&spi2>,"status";
    i2c0 = <&i2c0>,"status";
    i2c1 = <&i2c1>,"status";
    i2c2_iknowwhatimdoing = <&i2c2>,"status";
    i2c0_baudrate = <&i2c0>,"clock-frequency:0";
    i2c1_baudrate = <&i2c1>,"clock-frequency:0";
    i2c2_baudrate = <&i2c2>,"clock-frequency:0";

    act_led_gpio = <&act_led>,"gpios:4";
    act_led_activelow = <&act_led>,"gpios:8";
    act_led_trigger = <&act_led>,"linux,default-trigger";

    watchdog = <&watchdog>,"status";
    random = <&random>,"status";

    cs0_pin  = <&spi1_cs_pins>,"brcm,pins:0",
      <&spi1>,"cs-gpios:4";
    cs0_spidev = <&spidev1_0>,"status";
  };
};